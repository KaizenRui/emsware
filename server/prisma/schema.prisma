datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model stockcode {
  id       Int        @id @default(autoincrement())
  emc      String     @unique
  custpn   String     @unique
  value    String?
  mpn1     String
  qty      Int?

  bomItems bomitems[] @relation("PartBOMItems")
}

model billofmaterials {
  bom_id        Int         @id @default(autoincrement())
  parent_bom_id Int?
  customer      String?
  bom_name      String
  revisionno    Int?
  revision_date DateTime?
  history       String?
  status        String?

  bomItems      bomitems[]
  historyLogs   bom_history[]
}

model bomitems {
  id            Int        @id @default(autoincrement())
  bom_id        Int
  bom_name    String?    // optional: store BOM name for reference
  emc           String
  quantity      Int
  designators   String
  mpn1          String
  pcb_side      String?
  processdept   String?
  revision_note String?

  bom  billofmaterials @relation(fields: [bom_id], references: [bom_id])
  part stockcode       @relation("PartBOMItems", fields: [emc], references: [emc])

  @@index([bom_id])
  @@index([emc])
  @@unique([bom_id, emc])
}


model bom_history {
  id          Int       @id @default(autoincrement())
  bom_id      Int
  revisionno  Int
  emc         String?
  change_type String
  old_value   Int?
  new_value   Int?
  changed_by  Int
  changed_at  DateTime  @default(now())
  notes       String?

  bom billofmaterials @relation(fields: [bom_id], references: [bom_id])
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique
  password String
  role     String @default("user")
}
