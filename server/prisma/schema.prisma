datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// MASTER PARTS TABLE
model stockcode {
  id       Int        @id @default(autoincrement())
  emc      String @unique    
  custpn   String     
  value    String?
  mpn1     String
  qty      Int?       

  bomItems bomitems[]
}

// BOM MASTER TABLE
model billofmaterials {
  bom_id        Int      @id @default(autoincrement())

  customer      String?
  bom_name      String
  revisionno    Int      // required (no ?)
  revision_date DateTime?
  description   String?  // renamed from status

  bomItems      bomitems[]

  @@unique([bom_name, revisionno])  // enforce unique revision per BOM
}


// BOM ITEMS TABLE
model bomitems {
  id          Int    @id @default(autoincrement())
  bom_id      Int
  emc         String
  custpn      String?
  quantity    Int
  designators String
  mpn1        String
  pcb_side    String?
  processdept String?

  bom   billofmaterials @relation(fields: [bom_id], references: [bom_id])
  part  stockcode       @relation(fields: [emc], references: [emc])

  @@index([bom_id])
  @@index([emc])
  @@unique([bom_id, emc])
  @@unique([bom_id, custpn])
}


model User {
  id       Int    @id @default(autoincrement())
  username String @unique
  password String
  role     String @default("user")
}
